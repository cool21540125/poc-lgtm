apiVersion: 1

datasources:
- name: Loki
  type: loki
  access: proxy
  url: http://loki:3100
- name: Mimir
  type: prometheus
  access: proxy
  uid: mimir
  url: http://mimir:9009/prometheus
- name: Tempo
  type: tempo
  access: proxy
  url: http://tempo:3200
  jsonData:
    serviceMap:
      datasourceUid: mimir
    tracesToMetrics:
      datasourceUid: mimir
      tags:
        - key: service.name
          value: service_name
        - key: span.name
          value: span_name
        - key: http.status_code
          value: http_status_code
      queries:
        - name: Request rate
          query: rate(traces_spanmetrics_calls_total{$$__tags}[2m])
        - name: Error rate
          query: rate(traces_spanmetrics_calls_total{$$__tags,status_code="STATUS_CODE_ERROR"}[2m])
        - name: Duration (avg)
          query: histogram_avg(rate(traces_spanmetrics_latency{$$__tags}[2m]))
    nodeGraph:
      enabled: true
